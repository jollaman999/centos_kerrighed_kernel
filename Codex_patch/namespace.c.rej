--- ipc/namespace.c
+++ ipc/namespace.c
@@ -14,6 +14,38 @@
 
 #include "util.h"
 
+#ifdef CONFIG_KRG_IPC
+static int krg_init_ipc_ns(struct ipc_namespace *ns)
+{
+	int err = 0;
+
+	if (!current->create_krg_ns)
+		goto exit;
+
+	err = krg_sem_init_ns(ns);
+	if (err)
+		goto err_sem;
+
+	err = krg_msg_init_ns(ns);
+	if (err)
+		goto err_msg;
+
+	err = krg_shm_init_ns(ns);
+	if (err)
+		goto err_shm;
+
+	return err;
+
+err_shm:
+	krg_msg_exit_ns(ns);
+err_msg:
+	krg_sem_exit_ns(ns);
+err_sem:
+exit:
+	return err;
+}
+#endif
+
 static struct ipc_namespace *clone_ipc_ns(struct ipc_namespace *old_ns)
 {
 	struct ipc_namespace *ns;
@@ -141,6 +182,11 @@
 	sem_exit_ns(ns);
 	msg_exit_ns(ns);
 	shm_exit_ns(ns);
+#ifdef CONFIG_KRG_IPC
+	krg_sem_exit_ns(ns);
+	krg_msg_exit_ns(ns);
+	krg_shm_exit_ns(ns);
+#endif
 	kfree(ns);
 	atomic_dec(&nr_ipc_ns);
 
