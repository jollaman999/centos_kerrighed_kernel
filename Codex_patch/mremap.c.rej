--- mm/mremap.c
+++ mm/mremap.c
@@ -363,7 +382,11 @@
 	if (vma->vm_flags & VM_LOCKED) {
 		unsigned long locked, lock_limit;
 		locked = mm->locked_vm << PAGE_SHIFT;
+#ifdef CONFIG_KRG_MM
+		lock_limit = _lock_limit;
+#else
 		lock_limit = current->signal->rlim[RLIMIT_MEMLOCK].rlim_cur;
+#endif
 		locked += new_len - old_len;
 		ret = -EAGAIN;
 		if (locked > lock_limit && !capable(CAP_IPC_LOCK))
@@ -376,7 +399,11 @@
 
 	if (vma->vm_flags & VM_ACCOUNT) {
 		charged = (new_len - old_len) >> PAGE_SHIFT;
+#ifdef CONFIG_KRG_MM
+		if (security_vm_enough_memory_mm(mm, charged))
+#else
 		if (security_vm_enough_memory(charged))
+#endif
 			goto out_nc;
 	}
 
@@ -419,8 +446,18 @@
 			if (vma->vm_flags & VM_MAYSHARE)
 				map_flags |= MAP_SHARED;
 
+#ifdef CONFIG_KRG_MM
+			if (*_new_addr == 0) {
+				new_addr = get_unmapped_area(vma->vm_file, 0,
+					     new_len, vma->vm_pgoff, map_flags);
+				*_new_addr = new_addr;
+			}
+			else
+				new_addr = *_new_addr;
+#else
 			new_addr = get_unmapped_area(vma->vm_file, 0, new_len,
 						vma->vm_pgoff, map_flags);
+#endif
 			if (new_addr & ~PAGE_MASK) {
 				ret = new_addr;
 				goto out;
